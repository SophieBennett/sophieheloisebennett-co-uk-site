<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="John Doe">
    <meta name="description" content="John Doe&#39;s personal website">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The Hottest Tube Line: Modelling Tube Temperatures in R"/>
<meta name="twitter:description" content="Now, I’m the kind of big tube fanatic who has completed the “Can you name all the stations on the London Underground?” sporcle quiz more times than I can count. But even I have to acknowledge one major drawback of the london tube: it can get really bloody hot down there!
I’ve long suspected the Central line of being the biggest offender in this department, putting it near the bottom in my ranking of favourite tube lines."/>

    <meta property="og:title" content="The Hottest Tube Line: Modelling Tube Temperatures in R" />
<meta property="og:description" content="Now, I’m the kind of big tube fanatic who has completed the “Can you name all the stations on the London Underground?” sporcle quiz more times than I can count. But even I have to acknowledge one major drawback of the london tube: it can get really bloody hot down there!
I’ve long suspected the Central line of being the biggest offender in this department, putting it near the bottom in my ranking of favourite tube lines." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/tube_temperatures/" />



    
      <base href="/post/tube_temperatures/">
    
    <title>
  The Hottest Tube Line: Modelling Tube Temperatures in R · johndoe
</title>

    
      <link rel="canonical" href="/post/tube_temperatures/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.63.2" />
  </head>

  
  
  <body class="colorscheme-light">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      johndoe
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/projects/">Projects</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/contact/">Contact me</a>
          </li>
        
      
      
        
        
        
          
        
          
            
              <li class="navigation-item menu-separator">
                <span>|</span>
              </li>
              
            
            <li class="navigation-item">
              <a href="/pt-br/">Português</a>
            </li>
          
        
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>The Hottest Tube Line: Modelling Tube Temperatures in R</h1>
    </header>

    


<p>Now, I’m the kind of big tube fanatic who has completed the <a href="https://www.sporcle.com/games/sjb300/london-underground">“Can you name all the stations on the London Underground?” sporcle quiz</a> more times than I can count. But even I have to acknowledge one major drawback of the london tube: it can get <em>really</em> bloody hot down there!</p>
<p>I’ve long suspected the Central line of being the biggest offender in this department, putting it near the bottom in my ranking of favourite tube lines. (The best line, in case you’re wondering, is of course, the Victoria line - as recently evidenced by <a href="https://twitter.com/geofftech/status/1190219484151386113">Geoff Marshall’s twitter poll.</a>)</p>
<p>But, I’d been lacking hard data to support my theory.</p>
<p>Thankfully, I discovered recently that TfL have released a dataset of average monthly temparatures across each tube line, giving me the opportunity to do some fun tube-related analyses <em>and</em> attempt to make some cool TfL themed graphs. You can download the data yourself <a href="https://data.london.gov.uk/download/london-underground-average-monthly-temperatures/b01c7853-fff2-4781-9755-9b5e1404d78c/lu-average-monthly-temperatures.csv">here.</a></p>
<p>A few things to note about this data:</p>
<ul>
<li>The data runs from 2013-2018. The data don’t end cleanly on the same month for each tube line.</li>
<li>Tube temperatures appear to be measured daily, at the same time each day, then averaged across each month. The dataset only gives us the month-by-month breakdown.</li>
<li>The temperatures are measured at platform level. I’m not sure if temperatures are taken at every station and then averaged or not.</li>
<li>The District, Circle, Hammersmith &amp; City, and Metropolitan lines are grouped together into “sub-surface lines”.</li>
</ul>
<p>With that, time to look at the data.</p>
<div id="visualisation" class="section level2">
<h2>Visualisation</h2>
<hr />
<p>I started by making some line plots with a playful TfL theme.</p>
<p><img src="/post/tube_temperatures_files/figure-html/lineplot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The line plot is imo a little messy, but it does already draw out some interesting features. For instance, the hottest line is actually the <em>Bakerloo</em>, followed closely by the Central line. On the other hand, the sub-surface lines are the coldest lines, which isn’t super surprising.</p>
<p>There’s also clear periodicity in the data driven by seasonal changes; the temperatures rise sharply during the summer and fall again over the winter. Interestingly, the sub-surface lines seem more susceptible to changes in season than other lines.</p>
<p>Lastly, if you look carefully, the temperatures seem to be getting slightly hotter each year. We can see this more clearly by averaging temperatures across years:</p>
<p><img src="/post/tube_temperatures_files/figure-html/lineplot%202-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>After having some fun with TfL-themed line plots, I also decided to visualise the data through heatmaps, which I actually think end up being a better and cleaner choice of visualisation for this data. (The top figure shows data for the entire date range provided in the dataset, and the bottom figure displays data just from 2017-2018 to enable closer comparison between tube lines.)</p>
<p><img src="/post/tube_temperatures_files/figure-html/tile%20plot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The heatmaps enable us to see the patterns in the data more clearly. For instance, in the bottom figure we can see that while the underground lines increase by roughly 5 degrees from winter to summer, the sub-surface lines increase by around 10 whole degrees!</p>
</div>
<div id="modelling-tube-temperatures" class="section level2">
<h2>Modelling Tube Temperatures</h2>
<hr />
<p>Having visualised the data, I immediately wondered how well I could model the large periodicity in temperature, along with the other interesting effects in the data using multiple linear regression.</p>
<p>I started by making a simple additive model with year, month and tube line as my predictor variables.</p>
<pre><code>## 
## Call:
## lm(formula = temperature ~ Year + Month + tube, data = tube_temps)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.1207 -0.6974 -0.0265  0.6628  4.4089 
## 
## Coefficients:
##                         Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)           -676.97932   64.52518 -10.492  &lt; 2e-16 ***
## Year                     0.34850    0.03201  10.885  &lt; 2e-16 ***
## MonthAugust              5.16700    0.24418  21.160  &lt; 2e-16 ***
## MonthDecember           -0.79150    0.24418  -3.241 0.001269 ** 
## MonthFebruary           -2.52104    0.23232 -10.852  &lt; 2e-16 ***
## MonthJanuary            -2.33500    0.23232 -10.051  &lt; 2e-16 ***
## MonthJuly                5.37187    0.24244  22.157  &lt; 2e-16 ***
## MonthJune                3.54773    0.24244  14.633  &lt; 2e-16 ***
## MonthMarch              -1.70479    0.23232  -7.338 8.82e-13 ***
## MonthMay                 1.55777    0.23489   6.632 8.61e-11 ***
## MonthNovember            0.60425    0.24418   2.475 0.013671 *  
## MonthOctober             2.91500    0.24418  11.938  &lt; 2e-16 ***
## MonthSeptember           4.37275    0.24418  17.908  &lt; 2e-16 ***
## tubeCentral             -0.76882    0.20044  -3.836 0.000141 ***
## tubeJubilee             -4.18836    0.20044 -20.896  &lt; 2e-16 ***
## tubeNorthern            -2.35605    0.20044 -11.754  &lt; 2e-16 ***
## tubePiccadilly          -3.49312    0.20119 -17.362  &lt; 2e-16 ***
## tubeSub-Surface Lines   -8.02359    0.20044 -40.030  &lt; 2e-16 ***
## tubeVictoria            -2.88214    0.19901 -14.482  &lt; 2e-16 ***
## tubeWaterloo and City   -4.59051    0.20044 -22.902  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.138 on 500 degrees of freedom
##   (16 observations deleted due to missingness)
## Multiple R-squared:  0.9129, Adjusted R-squared:  0.9096 
## F-statistic: 275.8 on 19 and 500 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>This additive model already turned out pretty well, yielding an adjusted R<sup>2</sup> of 0.910.</p>
<p>However, problems emerged when I performed diagnostics to check for violations of linearity/normality (for which I used the <a href="https://cran.r-project.org/web/packages/olsrr/index.html">olsrr package</a>).</p>
<p><img src="/post/tube_temperatures_files/figure-html/model%201%20plots-1.png" width="672" /><img src="/post/tube_temperatures_files/figure-html/model%201%20plots-2.png" width="672" /><img src="/post/tube_temperatures_files/figure-html/model%201%20plots-3.png" width="672" /></p>
<p>From these plots, there appears to be some non-linearity as well as deviation from normality in the residuals, which is confirmed by tests of normality.</p>
<pre><code>## -----------------------------------------------
##        Test             Statistic       pvalue  
## -----------------------------------------------
## Shapiro-Wilk              0.9802         0.0000 
## Kolmogorov-Smirnov        0.0481         0.1803 
## Cramer-von Mises         38.2508          1e-04 
## Anderson-Darling          2.0876         0.0000 
## -----------------------------------------------</code></pre>
<p>However, my earlier visualisations gave me some clues into the source of the deviations from normality and linearity; we already saw that the seasonality effect is stronger on sub-surface lines than for other tube lines, suggesting an interaction effect between tube line and month.</p>
<p>To confirm my suspicions, I ran two models.</p>
<p>First, I ran a second additive model, excluding the sub-surface lines. This model yields a small improvement in adjusted R<sup>2</sup>.</p>
<pre><code>## 
## Call:
## lm(formula = temperature ~ Year + Month + tube, data = underground_tube_temps)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.4521 -0.5900  0.0077  0.5536  3.2499 
## 
## Coefficients:
##                         Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)           -758.53728   53.55018 -14.165  &lt; 2e-16 ***
## Year                     0.38897    0.02657  14.640  &lt; 2e-16 ***
## MonthAugust              4.87706    0.20268  24.063  &lt; 2e-16 ***
## MonthDecember           -0.54037    0.20268  -2.666  0.00796 ** 
## MonthFebruary           -2.23643    0.19283 -11.598  &lt; 2e-16 ***
## MonthJanuary            -2.07024    0.19283 -10.736  &lt; 2e-16 ***
## MonthJuly                4.99047    0.20104  24.824  &lt; 2e-16 ***
## MonthJune                3.26964    0.20104  16.264  &lt; 2e-16 ***
## MonthMarch              -1.51524    0.19283  -7.858 3.08e-14 ***
## MonthMay                 1.40819    0.19529   7.211 2.47e-12 ***
## MonthNovember            0.80020    0.20268   3.948 9.18e-05 ***
## MonthOctober             2.83677    0.20268  13.996  &lt; 2e-16 ***
## MonthSeptember           4.13677    0.20268  20.410  &lt; 2e-16 ***
## tubeCentral             -0.76836    0.15563  -4.937 1.13e-06 ***
## tubeJubilee             -4.18790    0.15563 -26.910  &lt; 2e-16 ***
## tubeNorthern            -2.35559    0.15563 -15.136  &lt; 2e-16 ***
## tubePiccadilly          -3.49313    0.15621 -22.361  &lt; 2e-16 ***
## tubeVictoria            -2.87544    0.15453 -18.608  &lt; 2e-16 ***
## tubeWaterloo and City   -4.59005    0.15563 -29.494  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8837 on 436 degrees of freedom
##   (14 observations deleted due to missingness)
## Multiple R-squared:  0.9235, Adjusted R-squared:  0.9203 
## F-statistic: 292.2 on 18 and 436 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Moreover, the residuals now look to be more normally distributed, and the plot of fitted values vs residuals also looks more promising:</p>
<p><img src="/post/tube_temperatures_files/figure-html/model%202%20plots-1.png" width="672" /><img src="/post/tube_temperatures_files/figure-html/model%202%20plots-2.png" width="672" /><img src="/post/tube_temperatures_files/figure-html/model%202%20plots-3.png" width="672" /></p>
<p>With this model looking promising, I decided to run a third model on the full dataset including an interaction term between month and tube line. To avoid testing for interactions between every month and tube line, I created a new dummy variable called “sub-surface”</p>
<pre><code>## 
## Call:
## lm(formula = temperature ~ Year + Month + tube + subsurface:Month, 
##     data = model_3_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.4720 -0.6038 -0.0169  0.5571  3.3487 
## 
## Coefficients: (1 not defined because of singularities)
##                              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                -678.90494   53.47671 -12.695  &lt; 2e-16 ***
## Year                          0.34946    0.02653  13.171  &lt; 2e-16 ***
## MonthAugust                   4.85730    0.21628  22.459  &lt; 2e-16 ***
## MonthDecember                -0.56013    0.21628  -2.590 0.009887 ** 
## MonthFebruary                -2.23643    0.20582 -10.866  &lt; 2e-16 ***
## MonthJanuary                 -2.07024    0.20582 -10.058  &lt; 2e-16 ***
## MonthJuly                     4.97392    0.21454  23.185  &lt; 2e-16 ***
## MonthJune                     3.25308    0.21454  15.163  &lt; 2e-16 ***
## MonthMarch                   -1.51524    0.20582  -7.362 7.74e-13 ***
## MonthMay                      1.40317    0.20844   6.732 4.71e-11 ***
## MonthNovember                 0.78044    0.21628   3.609 0.000340 ***
## MonthOctober                  2.81702    0.21628  13.025  &lt; 2e-16 ***
## MonthSeptember                4.11702    0.21628  19.036  &lt; 2e-16 ***
## tubeCentral                  -0.76674    0.16611  -4.616 5.01e-06 ***
## tubeJubilee                  -4.18628    0.16611 -25.202  &lt; 2e-16 ***
## tubeNorthern                 -2.35397    0.16611 -14.171  &lt; 2e-16 ***
## tubePiccadilly               -3.49312    0.16674 -20.950  &lt; 2e-16 ***
## tubeSub-Surface Lines        -6.13156    0.46393 -13.217  &lt; 2e-16 ***
## tubeVictoria                 -2.87037    0.16493 -17.403  &lt; 2e-16 ***
## tubeWaterloo and City        -4.58843    0.16611 -27.623  &lt; 2e-16 ***
## MonthApril:subsurface1       -2.04971    0.61057  -3.357 0.000849 ***
## MonthAugust:subsurface1       0.43171    0.63772   0.677 0.498746    
## MonthDecember:subsurface1    -3.89686    0.63772  -6.111 2.03e-09 ***
## MonthFebruary:subsurface1    -4.32662    0.61057  -7.086 4.84e-12 ***
## MonthJanuary:subsurface1     -4.16781    0.61057  -6.826 2.59e-11 ***
## MonthJuly:subsurface1         1.21110    0.63717   1.901 0.057924 .  
## MonthJune:subsurface1         0.36393    0.63717   0.571 0.568149    
## MonthMarch:subsurface1       -3.56614    0.61057  -5.841 9.49e-09 ***
## MonthMay:subsurface1         -0.85788    0.61145  -1.403 0.161245    
## MonthNovember:subsurface1    -3.45543    0.63772  -5.418 9.45e-08 ***
## MonthOctober:subsurface1     -1.26200    0.63772  -1.979 0.048384 *  
## MonthSeptember:subsurface1         NA         NA      NA       NA    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.9432 on 489 degrees of freedom
##   (16 observations deleted due to missingness)
## Multiple R-squared:  0.9415, Adjusted R-squared:  0.9379 
## F-statistic: 262.3 on 30 and 489 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>This model yields an even better fit (adjusted R<sup>2</sup> = 0.934).</p>
<p>The diagnostic tests also appear more promising for this model (although residuals are still not perfectly normal):</p>
<p><img src="/post/tube_temperatures_files/figure-html/model%203%20plots-1.png" width="672" /><img src="/post/tube_temperatures_files/figure-html/model%203%20plots-2.png" width="672" /></p>
<pre><code>## -----------------------------------------------
##        Test             Statistic       pvalue  
## -----------------------------------------------
## Shapiro-Wilk              0.9932         0.0186 
## Kolmogorov-Smirnov        0.0301         0.7323 
## Cramer-von Mises         40.9455          1e-04 
## Anderson-Darling          0.5903         0.1232 
## -----------------------------------------------</code></pre>
<p><img src="/post/tube_temperatures_files/figure-html/model%203%20plots-3.png" width="672" /></p>
</div>
<div id="further-exploration-passenger-numbers" class="section level2">
<h2>Further Exploration: Passenger Numbers</h2>
<hr />
<p>Now, the models above achieve a pretty good fit using just three variables; year, month and tube line. But, what exactly does the variable “tube line” represent here? For instance, what is it about the Central line that makes it hotter than the Jubilee?</p>
<p>One possible difference might be in the number of passengers on each line, with more passengers leading to hotter temperatures. On the otherhand, the differences in temperatures across tube lines could also be driven by structural differences between the lines, such as:</p>
<ul>
<li>how deep below the ground the tube lines run</li>
<li>what % of the tube journey is made underground</li>
<li>differences in the materials used to build the tunnels</li>
</ul>
<p>I was unable to find a lot of this data. But, I <em>was</em> able to find some data on passenger numbers from TfL.</p>
<p>The data gives the number of passengers (in millions) at each station between 2010-2017. Sadly, I couldn’t find data broken down by month so I had to make do with yearly passenger numbers.</p>
<p>Since the data was broken down by station rather than tube line, I also had to do some work to match up the stations to the tube lines (scraping and cleaning code is provided on github).</p>
<p>So, to what extent does passenger number influence tube temperature? Let’s take a look.</p>
<p><img src="/post/tube_temperatures_files/figure-html/passenger%20numbers-1.png" width="672" /></p>
<p>Well… not much. There <em>is</em> a small effect of passenger number within each tube line, but it certainly doesn’t seem to account for the differences in temperatures across tube lines.</p>
<p>With no access to further tube-related variables I had to end my journey here. However, even with the data I do have, I think there’s sufficient evidence to conclude that differences in temperatures across tube lines are probably driven by structural differences rather than passenger numbers.</p>
</div>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>Enter a text here.</p>
    
    
      
        © 2019 - 2020
      
       John Doe 
    
    
       · 
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
       · 
      [<a href="https://github.com/luizdepra/hugo-coder/tree/"></a>]
    
  </section>
</footer>

    </main>

    

  </body>

</html>
